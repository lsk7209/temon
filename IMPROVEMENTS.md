# MCP κΈ°λ° κ°μ„ μ‚¬ν•­ λ¦¬ν¬νΈ

## π“‹ κ°μ”

λ‹¤μ–‘ν• MCP (Model Context Protocol) λ„κµ¬λ¥Ό ν™μ©ν•μ—¬ ν”„λ΅μ νΈλ¥Ό λ³΄μ™„ν•κ³  κ°μ„ ν–μµλ‹λ‹¤.

---

## π” μ‚¬μ©λ MCP λ„κµ¬

1. **Exa Search MCP** - Next.js 14 + Cloudflare D1 λ² μ¤νΈ ν”„λ™ν‹°μ¤ κ²€μƒ‰
2. **Context7 MCP** - Next.js κ³µμ‹ λ¬Έμ„ μ΅°ν
3. **GitHub MCP** - μ μ‚¬ ν”„λ΅μ νΈ μ½”λ“ ν¨ν„΄ κ²€μƒ‰ (μΈμ¦ λ¬Έμ λ΅ μ ν•)

---

## β… μ™„λ£λ κ°μ„ μ‚¬ν•­

### 1. API λΌμ°νΈ κ°μ„  (Next.js 14 λ² μ¤νΈ ν”„λ™ν‹°μ¤)

#### Route Segment Config μ¶”κ°€
- `dynamic = 'force-dynamic'`: ν•­μƒ λ™μ  λ λ”λ§
- `revalidate`: μΊμ‹± μ „λµ μ„¤μ •
- `runtime = 'edge'`: Edge Runtime μ‚¬μ© (Cloudflare νΈν™)

```typescript
// app/api/results/route.ts
export const dynamic = 'force-dynamic'
export const revalidate = 0
export const runtime = 'edge'
```

#### μ—λ¬ μ²λ¦¬ κ°μ„ 
- νƒ€μ…λ³„ μ—λ¬ μ²λ¦¬ (400, 404, 500, 503)
- μƒμ„Έν• μ—λ¬ λ©”μ‹μ§€
- λ°μ΄ν„°λ² μ΄μ¤ μ—°κ²° μ‹¤ν¨ κ°μ§€

#### μ…λ ¥ κ²€μ¦ κ°•ν™”
- JSON νμ‹± μ—λ¬ μ²λ¦¬
- ν•„μ ν•„λ“ κ²€μ¦
- UUID ν•μ‹ κ²€μ¦
- λ‚ μ§ ν•μ‹ κ²€μ¦ (YYYY-MM-DD)

#### CORS ν—¤λ” μ¶”κ°€
- OPTIONS ν•Έλ“¤λ¬ κµ¬ν„
- ν™κ²½ λ³€μ κΈ°λ° Origin μ„¤μ •
- μ μ ν• HTTP λ©”μ„λ“ ν—μ©

### 2. API ν΄λΌμ΄μ–ΈνΈ μ ν‹Έλ¦¬ν‹° μƒμ„±

`lib/api-client.ts`:
- νƒ€μ… μ•μ „ν• API νΈμ¶ ν•¨μ
- μ—λ¬ μ²λ¦¬ ν†µν•©
- μ¬μ‚¬μ© κ°€λ¥ν• μΈν„°νμ΄μ¤

### 3. μ—λ¬ μ²λ¦¬ κ°μ„ 

#### Error Boundary (`app/error.tsx`)
- μ „μ—­ μ—λ¬ νμ΄μ§€
- κ°λ° ν™κ²½μ—μ„ μ—λ¬ λ©”μ‹μ§€ ν‘μ‹
- Analytics μ—λ¬ μ¶”μ 
- μ‚¬μ©μ μΉν™”μ  UI

#### 404 νμ΄μ§€ (`app/not-found.tsx`)
- λΈλλ“ μΌκ΄€μ„± μ μ§€
- λ„¤λΉ„κ²μ΄μ… μµμ… μ κ³µ

### 4. ν…μ¤νΈ κ²°κ³Ό μ €μ¥ ν›…

`hooks/use-test-result.ts`:
- μ¬μ‚¬μ© κ°€λ¥ν• μ»¤μ¤ν…€ ν›…
- λ΅λ”© μƒνƒ κ΄€λ¦¬
- μ—λ¬ μ²λ¦¬
- Analytics μλ™ μ¶”μ 

---

## π€ μ„±λ¥ μµμ ν™”

### μΊμ‹± μ „λµ
- **κ²°κ³Ό API**: μΊμ‹± λΉ„ν™μ„±ν™” (ν•­μƒ μµμ‹  λ°μ΄ν„°)
- **ν†µκ³„ API**: 5λ¶„κ°„ μΊμ‹± (ν†µκ³„λ” μμ£Ό λ³€κ²½λμ§€ μ•μ)

### Edge Runtime
- λ¨λ“  API λΌμ°νΈλ¥Ό Edge RuntimeμΌλ΅ μ‹¤ν–‰
- Cloudflare Workersμ™€ μ™„λ²½ νΈν™
- λ‚®μ€ μ§€μ—°μ‹κ°„

---

## π”’ λ³΄μ• κ°•ν™”

### μ…λ ¥ κ²€μ¦
- λ¨λ“  μ…λ ¥ ν•„λ“ κ²€μ¦
- νƒ€μ… μ²΄ν¬
- ν•μ‹ κ²€μ¦ (UUID, λ‚ μ§ λ“±)

### μ—λ¬ λ©”μ‹μ§€
- ν”„λ΅λ•μ… ν™κ²½μ—μ„ λ―Όκ°ν• μ •λ³΄ μ¨κΉ€
- κ°λ° ν™κ²½μ—μ„λ§ μƒμ„Έ μ—λ¬ ν‘μ‹

### CORS μ„¤μ •
- ν™κ²½ λ³€μ κΈ°λ° Origin μ ν•
- μ μ ν• HTTP λ©”μ„λ“λ§ ν—μ©

---

## π“ κ°μ„  ν¨κ³Ό

### μ½”λ“ ν’μ§
- β… νƒ€μ… μ•μ „μ„± ν–¥μƒ
- β… μ—λ¬ μ²λ¦¬ κ°•ν™”
- β… μ¬μ‚¬μ©μ„± κ°μ„ 
- β… Next.js 14 λ² μ¤νΈ ν”„λ™ν‹°μ¤ μ¤€μ

### μ‚¬μ©μ κ²½ν—
- β… λ…ν™•ν• μ—λ¬ λ©”μ‹μ§€
- β… λ΅λ”© μƒνƒ ν‘μ‹
- β… μ—λ¬ λ°μƒ μ‹ λ³µκµ¬ μµμ…

### κ°λ°μ κ²½ν—
- β… μ¬μ‚¬μ© κ°€λ¥ν• ν›…
- β… νƒ€μ… μ•μ „ν• API ν΄λΌμ΄μ–ΈνΈ
- β… μΌκ΄€λ μ—λ¬ μ²λ¦¬

---

## π”„ λ‹¤μ λ‹¨κ³„ (κ¶μ¥)

### 1. ν…μ¤νΈ νμ΄μ§€ μ—°κ²°
λ¨λ“  ν…μ¤νΈ νμ΄μ§€μ— κ²°κ³Ό μ €μ¥ λ΅μ§ μ—°κ²°:
```typescript
// μμ‹: app/coffee-mbti/test/page.tsx
import { useTestResult } from '@/hooks/use-test-result'

const { saveResult } = useTestResult({
  testId: 'coffee-mbti',
  onSuccess: (resultId) => {
    router.push(`/coffee-mbti/test/result?type=${result}&id=${resultId}`)
  }
})

// ν…μ¤νΈ μ™„λ£ μ‹
await saveResult(result, answers)
```

### 2. Rate Limiting μ¶”κ°€
- Cloudflare Workers Rate Limiting
- IP κΈ°λ° μ ν•
- API ν‚¤ κΈ°λ° μΈμ¦ (μ„ νƒ)

### 3. λ¨λ‹ν„°λ§ κ°•ν™”
- μ—λ¬ λ΅κΉ… μ„λΉ„μ¤ μ—°λ™ (Sentry λ“±)
- μ„±λ¥ λ©”νΈλ¦­ μμ§‘
- μ•λ¦Ό μ„¤μ •

### 4. ν…μ¤νΈ μ½”λ“ μ‘μ„±
- API λΌμ°νΈ λ‹¨μ„ ν…μ¤νΈ
- ν›… ν…μ¤νΈ
- ν†µν•© ν…μ¤νΈ

---

## π“ μ°Έκ³  μλ£

### MCP κ²€μƒ‰ κ²°κ³Ό
- Next.js 14 App Router λ² μ¤νΈ ν”„λ™ν‹°μ¤
- Cloudflare D1 λ°μ΄ν„°λ² μ΄μ¤ μ—°λ™ ν¨ν„΄
- Edge Runtime μ‚¬μ©λ²•
- μ—λ¬ μ²λ¦¬ ν¨ν„΄

### μ μ©λ ν¨ν„΄
1. Route Segment Config ν™μ©
2. νƒ€μ… μ•μ „ν• API ν΄λΌμ΄μ–ΈνΈ
3. μ¬μ‚¬μ© κ°€λ¥ν• μ»¤μ¤ν…€ ν›…
4. μΌκ΄€λ μ—λ¬ μ²λ¦¬

---

**κ°μ„  μ™„λ£μΌ**: 2024λ…„ 12μ›”  
**λ‹¤μ κ²€ν† **: ν…μ¤νΈ νμ΄μ§€ μ—°κ²° λ° μ¶”κ°€ μµμ ν™”

